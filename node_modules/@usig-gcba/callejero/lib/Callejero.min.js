!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("@usig-gcba/usig-core"),require("isomorphic-fetch")):"function"==typeof define&&define.amd?define("Callejero",["@usig-gcba/usig-core","isomorphic-fetch"],r):"object"==typeof exports?exports.Callejero=r(require("@usig-gcba/usig-core"),require("isomorphic-fetch")):e.Callejero=r(e["@usig-gcba/usig-core"],e["isomorphic-fetch"])}(this,function(e,r){return function(e){function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var a={};return r.m=e,r.c=a,r.i=function(e){return e},r.d=function(e,a,t){r.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(a,"a",a),a},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=6)}([function(e,r,a){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function n(e,r){for(var a=!0,t=0;t<e.length;t++){var n=e[t];if(n.lastIndex=0,!n.test(r[2])){a=!1;break}}return a}function o(e){if(E=!1,e.length!=w.data.Callejero.length)return void alert("Se produjo un error al cargar la información de cruces de calles.");for(var r=0;r<w.data.Callejero.length;r++)w.data.Callejero[r].push(e[r])}function l(e){var r=60*y.expirationTime*1e3,a={calles:JSON.stringify(e),expiration:(new Date).getTime()+r};try{localStorage&&(localStorage.callejero=JSON.stringify(a))}catch(e){console.error(e)}}function u(e){return S=!0,w.data.Callejero=e,E=!1,d("ready"),O}function i(){E=!0,fetch(y.server+"?full=1&cruces=1&encoding="+y.encoding).then(function(e){return e.json()},function(e){return console.log("Error!")}).then(function(e){return o(e)})}function c(){E=!0;var e=y.loadFullDatabase?"?full=1&encoding="+y.encoding+"&minusculas="+(y.callesEnMinusculas?1:0):"?encoding="+y.encoding+"&minusculas="+(y.callesEnMinusculas?1:0);return fetch(y.server+e+"&date="+Date.now()).then(function(e){return e.json()}).catch(function(e){throw e}).then(function(e){return l(e),u(e)}).catch(function(e){throw e})}function s(e){if(!E){if(!f())return e?new Promise(function(r){return r(u(e))}):c();var r;try{return localStorage.callejero&&(r=JSON.parse(localStorage.callejero)),r&&r.calles&&r.calles.length>500?(new Date).getTime()<r.expiration?new Promise(function(e){return e(u(JSON.parse(r.calles)))}):c().catch(function(e){return u(JSON.parse(r.calles))}):e?(l(e),new Promise(function(r){return r(u(e))})):c().catch(function(e){throw e})}catch(r){return console.error(r),e?new Promise(function(r){return r(u(e))}):c()}}}function f(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function d(e){for(var r=0;r<x[e].length;r++)x[e][r]()}function h(e,r){for(var a=!1,t=0;t<x[e].length;t++)a=a||x[e][t]==r;a||x[e].push(r)}Object.defineProperty(r,"__esModule",{value:!0}),a(5);var g=a(1),C=t(g),j=a(3),p=t(j),v=a(2),m=a(4),b=t(m),w=void 0;void 0===w&&(w={}),void 0===w.data&&(w.data={}),void 0===w.defaults&&(w.defaults={}),w.defaults.Callejero={server:"https://servicios.usig.buenosaires.gob.ar/callejero",lazyDataLoad:!1,loadFullDatabase:!0,callesEnMinusculas:!0,encoding:"utf-8",expirationTime:10080};var y={},S=!1,x={ready:[]},E=!1,O={init:function(e){return y=Object.assign({},w.defaults.Callejero,e),"function"==typeof y.onReady&&h("ready",y.onReady),!w.data.Callejero&&!y.lazyDataLoad||w.data.Callejero&&(w.data.Callejero.calles||w.data.Callejero.calles&&w.data.Callejero.calles.length<500)?s(y.callejero).catch(function(e){if(y.callejero)return u(y.callejero);throw e}):(w.data.Callejero&&(d("ready"),x.ready=[]),new Promise(function(e){return e(O)}))},cargarCalles:function(e){return e&&O.listo()?e.override?s():new Promise(function(e){return e(O)}):s()},buscarPorCodigo:function(e){if(!O.listo())throw new p.default;var r=[];if(/^[0-9]+$/.test(e)){var a=b.default.binarySearch(w.data.Callejero,e,function(e,r){return e[0]-r});if(a>-1){var t=w.data.Callejero[a];r.push(C.default.construirCalle(t[0],t[1]));for(var n=a+1;n<w.data.Callejero.length&&w.data.Callejero[n][0]===e;)t=w.data.Callejero[n],r.push(C.default.construirCalle(t[0],t[1])),n++;for(n=a-1;n>=0&&w.data.Callejero[n][0]===e;)t=w.data.Callejero[n],r.unshift(C.default.construirCalle(t[0],t[1])),n--}}return r},getAlturas:function(e,r){if(!O.listo())throw new p.default;var a=[];if(/^[0-9]+$/.test(e)){var t=b.default.binarySearch(w.data.Callejero,e,function(e,r){return e[0]-r});if(t>-1){var n=w.data.Callejero[t];n[1]===r&&n[3].forEach(function(e){return a.push(e)});for(var o=t+1;o<w.data.Callejero.length&&w.data.Callejero[o][0]===e;)w.data.Callejero[o][1]===r&&(n=w.data.Callejero[o],n[3].forEach(function(e){return a.push(e)})),o++;for(o=t-1;o>=0&&w.data.Callejero[o][0]===e;)w.data.Callejero[o][1]===r&&(n=w.data.Callejero[o],n[3].forEach(function(e){return a.push(e)})),o--}}return a},getCruces:function(e,r){if(!O.listo())throw new p.default;var a=[];if(/^[0-9]+$/.test(e)){var t=b.default.binarySearch(w.data.Callejero,e,function(e,r){return e[0]-r});if(t>-1){var n=w.data.Callejero[t];n[1]===r&&n[4].forEach(function(e){return a.push(e)});for(var o=t+1;o<w.data.Callejero.length&&w.data.Callejero[o][0]===e;)w.data.Callejero[o][1]===r&&(n=w.data.Callejero[o],n[4].forEach(function(e){return a.push(e)})),o++;for(o=t-1;o>=0&&w.data.Callejero[o][0]===e;)w.data.Callejero[o][1]===r&&(n=w.data.Callejero[o],n[4].forEach(function(e){return a.push(e)})),o--}}return a},seCruzaCon:function(e,r){var a=O.getCruces(e.codigo,e.nombre);if(a)return a.indexOf(r.codigo)>=0},matcheaCalle:function(e,r){if(!O.listo())throw new p.default;var a=[],t=[],o=b.default.translate(e.replace(/"/g,""),"áéíóúüÁÉÍÓÚÜàèìòùÀÈÌÒÙ","aeiouuAEIOUUaeiouAEIOU").toUpperCase().trim(),l=o.split(" "),u=l.map(function(e){return new RegExp("^"+e+"| "+e,"gi")}),c=new RegExp("SNO|SIN NOMBRE OFICIAL|NO OFICIAL|PASAJE|PJE","i");if(!O.listo())throw s(),new p.default;for(var f=0;f<w.data.Callejero.length&&!(n(u,w.data.Callejero[f])&&(c.test(w.data.Callejero[f][1])||0===w.data.Callejero[f][3].length?t.push(C.default.construirCalle(w.data.Callejero[f][0],w.data.Callejero[f][1])):a.push(C.default.construirCalle(w.data.Callejero[f][0],w.data.Callejero[f][1])),!isNaN(parseInt(r))&&a.length>=parseInt(r)));f++);return a=a.concat(t),!isNaN(parseInt(r))&&a.length>=parseInt(r)&&(a=a.splice(0,r)),w.data.Callejero[0].length<5&&!E&&i(),a},tieneTramosComoAv:function(e){if(!O.listo())throw new p.default;var r=b.default.binarySearch(w.data.Callejero,e,function(e,r){return e[0]-r});return r>0&&0!==e&&(w.data.Callejero[r-1][0]===e||w.data.Callejero[r+1][0]===e)},getNombreCalle:function(e,r){for(var a=O.buscarPorCodigo(e),t=0;t<a.length;t++)if(O.alturaValida(a[t],r))return a[t].nombre;return""},listo:function(){return w.data.Callejero&&w.data.Callejero instanceof Array&&0!==w.data.Callejero.length},inicializado:function(){return S},alturaValida:function(e,r){if(e.alturas=O.getAlturas(e.codigo,e.nombre),e.alturas instanceof Array){if(0===e.alturas.length)throw new v.ErrorCalleSinAlturas(e.nombre);var a=!1;for(var t in e.alturas)a=a||parseInt(e.alturas[t][0])<=parseInt(r)&&parseInt(e.alturas[t][1])>=parseInt(r);return a}},calleToString:function(e){return e.nombre}};r.default=O,e.exports=r.default},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default={construirCalle:function(e,r){return{codigo:e,nombre:r,tipo:"CALLE",toString:r}}},e.exports=r.default},function(e,r,a){"use strict";function t(e){this.id=3,this.message="La calle {calle} no posee alturas oficiales. Utilice intersecciones para hallar direcciones v&aacute;lidas sobre esta calle o escriba S/N en lugar de la altura.",this.toString=function(){return this.message.replace("{calle}",e)},this.getNombreCalle=function(){return e},this.getErrorMessage=function(){return usig.ErrorCalleSinAlturas.defaults.texts.message.replace("{calle}",e)}}Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorCalleSinAlturas=t},function(e,r,a){"use strict";function t(){this.message="El callejero no se encuentra cargado aún o se produjo un error al intentar cargarlo",this.toString=function(){return"Callejero no disponible."},this.getErrorMessage=function(){return this.message}}Object.defineProperty(r,"__esModule",{value:!0}),r.default=t,e.exports=r.default},function(r,a){r.exports=e},function(e,a){e.exports=r},function(e,r,a){e.exports=a(0)}])});